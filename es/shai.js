var t,e,r=function(t){void 0===t&&(t="-");var e=(new Date).getTime();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join(t).replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))};function n(t,e){if(Object.assign)return Object.assign(t,e);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}!function(t){t[t.increment=0]="increment",t[t.uuid=1]="uuid"}(t||(t={})),function(t){t[t.some=0]="some",t[t.every=1]="every",t[t.unique=2]="unique"}(e||(e={}));var i=["操作失败！","查询参数错误！","没有请求参数","操作成功！"],s=function(){function s(){this.__datas=[],this.__opt={uniqueKey:"id",uniqueType:t.increment,asyncResult:function(t){return[200,t]},success:function(t,e){return{code:0,message:"string"!=typeof e?i[3]:e,data:t}},failure:function(t,e){return{code:500,message:"string"!=typeof e?i[0]:e}}},this.exist=this.exist.bind(this),this.create=this.create.bind(this),this.update=this.update.bind(this),this.read=this.read.bind(this),this.delete=this.delete.bind(this),this.list=this.list.bind(this),this.pageList=this.pageList.bind(this),this.asyncExist=this.asyncExist.bind(this),this.asyncCreate=this.asyncCreate.bind(this),this.asyncUpdate=this.asyncUpdate.bind(this),this.asyncRead=this.asyncRead.bind(this),this.asyncDelete=this.asyncDelete.bind(this),this.asyncList=this.asyncList.bind(this),this.asyncPageList=this.asyncPageList.bind(this)}return s.prototype.__filter=function(r,n,s){var a=this;if(s===e.unique&&r&&!r[this.__opt.uniqueKey])return this.__opt.failure(1,i[1]);var o=r[this.__opt.uniqueKey],u=[];if(o){var c=this.__opt.uniqueType===t.increment;"string"==typeof o&&c&&/\d+/.test(o)&&(r[this.__opt.uniqueKey]=parseInt(o))}return s===e.unique&&o?u=this.__datas.filter((function(t){return t[a.__opt.uniqueKey]===r[a.__opt.uniqueKey]})):s!==e.some&&s!==e.every||(u=this.__datas.filter((function(t){return Object.keys(r)[s===e.some?"some":"every"]((function(e){return t[e]===r[e]}))}))),n(u)},s.prototype.__async=function(t,e){var r=this;if(void 0===e&&(e=200),!Promise)throw new Error("运行环境不支持异步！");return new Promise((function(n){setTimeout((function(){n(r.__opt.asyncResult(t()))}),e)}))},s.prototype.__noparam=function(){return this.__opt.failure(2,i[2])},Object.defineProperty(s.prototype,"data",{get:function(){return this.__datas},set:function(t){t&&t.length&&(this.__datas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"config",{set:function(t){this.__opt=n(this.__opt,t)},enumerable:!0,configurable:!0}),s.prototype.create=function(e,n,i){if(!e)return this.__noparam();var s=Array.isArray(e),a=this.__datas.length?this.__datas[0]:s?e[0]:e,o=this.__opt.uniqueType===t.increment,u=Object.keys(a),c=this.__datas.length?this.__datas[this.__datas.length-1][this.__opt.uniqueKey]:0;if(s)for(var _=0;_<e.length;_++){var h=e[_];if(!Object.keys(h).every((function(t){return~u.indexOf(t)})))return this.__opt.failure(0,i);o&&c++,h[this.__opt.uniqueKey]=o?c:r()}else{if(a!==e&&!Object.keys(e).every((function(t){return~u.indexOf(t)})))return this.__opt.failure(0,i);o&&c++,e[this.__opt.uniqueKey]=o?c:r()}return this.__datas=this.__datas.concat(e),this.__opt.success(e,n)},s.prototype.asyncCreate=function(t,e,r,n){var i=this;return this.__async((function(){return i.create(t,e,r)}),n)},s.prototype.update=function(t,r,n){var i=this;return t?this.__filter(t,(function(e){if(e.length){for(var s in t)t.hasOwnProperty(s)&&e[0][s]&&(e[0][s]=t[s]);return i.__opt.success(e[0],r)}return i.__opt.failure(0,n)}),e.unique):this.__noparam()},s.prototype.asyncUpdate=function(t,e,r,n){var i=this;return this.__async((function(){return i.update(t,e,r)}),n)},s.prototype.read=function(t,r,i,s){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var e={};return"object"==typeof s&&(e=n(e,t[0]),e=n(e,s)),a.__opt.success("object"==typeof s?e:t[0],r)}return a.__opt.failure(0,i)}),e.every):this.__noparam()},s.prototype.asyncRead=function(t,e,r,n,i){var s=this;return this.__async((function(){return s.read(t,e,r,n)}),i)},s.prototype.delete=function(e,r,n){var i=this;if(!e)return this.__noparam();Array.isArray(e)||(e=[e]);var s=0;return e.forEach((function(e){for(var r=0;r<i.__datas.length;r++){var n=i.__datas[r],a="object"==typeof e?e[i.__opt.uniqueKey]:e;if((i.__opt.uniqueType===t.increment&&/\d+/.test(a)?parseInt(a):a)===n[i.__opt.uniqueKey]){i.__datas.splice(r,1),s++;break}}})),s>0?this.__opt.success(0,r):this.__opt.failure(0,n)},s.prototype.asyncDelete=function(t,e,r,n){var i=this;return this.__async((function(){return i.delete(t,e,r)}),n)},s.prototype.exist=function(t,r,i,s){var a=this;return t?this.__filter(t,(function(t){if(1===t.length){var e={};return"object"==typeof s&&(e=n(e,t[0]),e=n(e,s)),a.__opt.success("object"==typeof s?e:t[0],r)}return a.__opt.failure(0,i)}),e.every):this.__noparam()},s.prototype.asyncExist=function(t,e,r,n,i){var s=this;return this.__async((function(){return s.exist(t,e,r,n)}),i)},s.prototype.list=function(t,r){var n=this;return t&&Object.keys(t).length?this.__filter(t,(function(t){return t.length?n.__opt.success(t,r):n.__opt.success(n.__datas,r)}),e.some):this.__opt.success(this.__datas,r)},s.prototype.asyncList=function(t,e,r){var n=this;return this.__async((function(){return n.list(t,e)}),r)},s.prototype.pageList=function(t,r,n){var i=this,s=t.pageSize,a=t.pageIndex;if(!s||!a)return this.__noparam();"string"==typeof s&&(s=parseInt(s)),"string"==typeof a&&(a=parseInt(a));var o=this.__datas;r&&this.__filter(r,(function(t){return t.length?o=t:i.__datas.length?o=i.__datas:t}),e.some);var u=o.length,c=Math.ceil(u/s),_=a>c?c:a<1?1:a,h=u-(c-1)*s+(c-1)*s,p=this.__datas.slice((a-1)*s,a<c?a*s:h);return this.__opt.success({total:u,pageIndex:_,pageSize:s,pageCount:c,list:p},n)},s.prototype.asyncPageList=function(t,e,r,n){var i=this;return this.__async((function(){return i.pageList(t,e,r)}),n)},s}();function a(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(t.hasOwnProperty(r)){var n=t[r];e[r]="object"==typeof n?a(n):n}return e}var o=function(){function t(){this.__funcs=[],this.__data=[],this.__propKey="setting",this.__access=new s,this.use=this.use.bind(this),this.gen=this.gen.bind(this)}return t.prototype.setv=function(t,e){var r=t.length-1;t.reduce((function(t,n,i){return i===r&&(t[n]=e),t[n]}),this.__data)},t.prototype.addChild=function(t,e,r,i){var s=i.at||0;r--;for(var o=function(o,c){var _=t[o];i.renew&&s===r&&(_=Object.assign?Object.assign(_,i.renew):n(_,i.renew)),i.remove&&s===r&&i.remove.forEach((function(t){_.hasOwnProperty(t)&&delete _[t]})),r>0&&!_.hasOwnProperty(e)&&(_[e]=a(t),u.addChild(_[e],e,r,i))},u=this,c=0,_=t.length;c<_;c++)o(c);return t},t.prototype.transform=function(t,e){if(e){var r=function(t){var e=1;return"number"==typeof t?e=t:Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=~~(Math.random()*(t[1]-t[0])+t[0])),e},n="number"==typeof e||Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]?r(e):"object"==typeof e&&e.length?r(e.length):1,i=new Array(n);delete t[this.__propKey];for(var s=0;s<n;s++)i[s]=a(t);if("object"!=typeof e||"number"==typeof e||Array.isArray(e))t=i;else{var o="number"==typeof e.level?e.level:1,u=e.key||"children";if(e.at&&e.at>=o)throw new Error('setting "at" out of range!');u&&(t[u]=this.addChild(i,u,o,e))}}return t},t.prototype.parseBlock=function(){var t=this,e=function(r,n){var i,s;!Array.isArray(r)&&r.hasOwnProperty(t.__propKey)&&(s=(i=r)[t.__propKey],r=i=t.transform(i,s),n?t.setv(n,r):t.setv([],t.__data=r));var a=function(t){if(r.hasOwnProperty(t)){var i=r[t];Array.isArray(i)&&"▒"!==i[0]?i.forEach((function(r,i){return e(r,n?n.concat([t,i]):[t,i])})):Array.isArray(i)||"object"!=typeof i||e(i,n?n.concat([t]):[t])}};for(var o in r)a(o)};e(this.__data)},t.prototype.setValues=function(t,e){var r=this;if(Array.isArray(t))if("▒"===t[0]){var n=e||[],i=this.__funcs[t[1]].concat();try{this.setv(n,i.length>0?i[0].apply(i,i[1]):t)}catch(e){throw new Error((n.length>0?n.join("."):t)+": error, "+e)}}else t.forEach((function(t,n){return r.setValues(t,e?e.concat([n]):[n])}));else"object"==typeof t&&Object.keys(t).forEach((function(n){return r.setValues(t[n],e?e.concat([n]):[n])}))},t.prototype.use=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return["▒",this.__funcs.push([t,e])-1]},t.prototype.gen=function(t,e){if("object"==typeof t)return e&&(this.__propKey=e),this.__data=t,this.parseBlock(),this.setValues(this.__data),this.__access.data=this.__data,this.__data},Object.defineProperty(t.prototype,"access",{get:function(){return this.__access},enumerable:!0,configurable:!0}),t}();export default o;
//# sourceMappingURL=shai.js.map
