!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Shai=e()}(this,(function(){"use strict";var t=function(t){void 0===t&&(t="-");var e=(new Date).getTime();return["xxxxxxxx","xxxx","4xxx","yxxx","xxxxxxxxxxxx"].join(t).replace(/[xy]/g,(function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?r:3&r|8).toString(16)}))};function e(t,e){if(Object.assign)return Object.assign(t,e);for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}var r=function(){function r(){this.__datas=[],this.__opt={uniqueKey:"id",httpStatus:200,failureCode:0,successCode:100,codeField:"code",msgField:"message",dataField:"data"},this.exist=this.exist.bind(this),this.create=this.create.bind(this),this.update=this.update.bind(this),this.read=this.read.bind(this),this.delete=this.delete.bind(this),this.list=this.list.bind(this),this.pageList=this.pageList.bind(this),this.asyncExist=this.asyncExist.bind(this),this.asyncCreate=this.asyncCreate.bind(this),this.asyncUpdate=this.asyncUpdate.bind(this),this.asyncRead=this.asyncRead.bind(this),this.asyncDelete=this.asyncDelete.bind(this),this.asyncList=this.asyncList.bind(this),this.asyncPageList=this.asyncPageList.bind(this)}return r.prototype.__f=function(t,e){var r,n=["操作数据失败！","没有找到记录！","查询条件错误！"];return Array.isArray(e)&&e.length?n.map((function(t,r){return e[r]?e[r]:t})):"string"==typeof e&&(n[0]=e),(r={})[this.__opt.codeField]=this.__opt.failureCode,r[this.__opt.msgField]=n[t],r},r.prototype.__s=function(t,e){var r;return(r={})[this.__opt.codeField]=this.__opt.failureCode,r[this.__opt.msgField]=void 0!==e?e:"操作成功！",r[this.__opt.dataField]=t,r},r.prototype.__filter=function(t,e,r,n){var i=this;if("unique"===r&&t&&!t[this.__opt.uniqueKey])return this.__f(2,n);var s=t[this.__opt.uniqueKey],a=[];if(s){var o=this.__datas[0][this.__opt.uniqueKey];if(!o)return this.__f(2,n);"string"==typeof s&&"number"==typeof o&&/\d+/.test(s)&&(t[this.__opt.uniqueKey]=parseInt(s))}return"unique"===r&&s?a=this.__datas.filter((function(e){return e[i.__opt.uniqueKey]===t[i.__opt.uniqueKey]})):"some"!==r&&"every"!==r||(a=this.__datas.filter((function(e){return Object.keys(t)[r]((function(r){return e[r]===t[r]}))}))),e(a)},r.prototype.__async=function(t,e){var r=this;if(void 0===e&&(e=200),!Promise)throw new Error("运行环境不支持异步！请升级为ES6，或使用Promise垫片。");return new Promise((function(n){setTimeout((function(){n(t([r.__opt.httpStatus]))}),e)}))},Object.defineProperty(r.prototype,"data",{get:function(){return this.__datas},set:function(t){t&&t.length&&(this.__datas=t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"config",{set:function(t){this.__opt=e(this.__opt,t)},enumerable:!0,configurable:!0}),r.prototype.create=function(e,r,n){var i=this,s=this.__datas[this.__datas.length-1][this.__opt.uniqueKey];if(s){var a="number"==typeof s;if(Array.isArray(e)){var o=e.map((function(e){return a&&s++,e[i.__opt.uniqueKey]=a?s:t(),e}));this.__datas.concat(o)}else a&&s++,e[this.__opt.uniqueKey]=a?s:t(),this.__datas.push(e);return this.__datas?this.__s(e,r):this.__f(0,n)}return this.__f(2,n)},r.prototype.asyncCreate=function(t,e,r,n){var i=this;return this.__async((function(n){return n.concat(i.create(t,e,r))}),n)},r.prototype.update=function(t,e,r){var n=this;return this.__filter(t,(function(i){if(i.length){for(var s in t)t.hasOwnProperty(s)&&i[0][s]&&(i[0][s]=t[s]);return n.__s(i[0],e)}return n.__f(0,r)}),"unique",r)},r.prototype.asyncUpdate=function(t,e,r,n){var i=this;return this.__async((function(n){return n.concat(i.update(t,e,r))}),n)},r.prototype.read=function(t,r,n,i){var s=this;return this.__filter(t,(function(t){return console.log(t),t.length?s.__s(r?e(t[0],r):t[0],n):s.__f(1,i)}),"every",i)},r.prototype.asyncRead=function(t,e,r,n,i){var s=this;return this.__async((function(i){return i.concat(s.read(t,e,r,n))}),i)},r.prototype.delete=function(t,e,r){var n=this;Array.isArray(t)||(t=[t]);var i=0;return t.forEach((function(t){for(var e=0;e<n.__datas.length;e++){var r=n.__datas[e],s="object"==typeof t?t[n.__opt.uniqueKey]:t;if((/\d+/.test(s)?parseInt(s):s)===r[n.__opt.uniqueKey]){n.__datas.splice(e,1),i++;break}}})),i>0?this.__s(this.__datas,e):this.__f(0,r)},r.prototype.asyncDelete=function(t,e,r,n){var i=this;return this.__async((function(n){return n.concat(i.delete(t,e,r))}),n)},r.prototype.exist=function(t,r,n,i){var s=this;return this.__filter(t,(function(t){return 1===t.length?s.__s(r?e(t[0],r):t[0],n):s.__f(1,i)}),"every",i)},r.prototype.asyncExist=function(t,e,r,n,i){var s=this;return this.__async((function(i){return i.concat(s.exist(t,e,r,n))}),i)},r.prototype.list=function(t,e,r){var n=this;return t&&Object.keys(t).length?this.__filter(t,(function(t){return t.length?n.__s(t,e):n.__datas.length?n.__s(n.__datas,e):n.__f(1,r)}),"some",r):this.__datas.length?this.__s(this.__datas,e):this.__f(1,r)},r.prototype.asyncList=function(t,e,r,n){var i=this;return this.__async((function(n){return n.concat(i.list(t,e,r))}),n)},r.prototype.pageList=function(t,e,r){var n=this,i=t.pageSize,s=t.pageIndex;delete t.pageIndex,delete t.pageSize;var a=this.__datas;if(Object.keys(t).length&&this.__filter(t,(function(t){return t.length?a=t:n.__datas.length?a=n.__datas:t}),"some",r),a.length){var o=a.length,u=Math.ceil(o/i),_=s>u?u:s<1?1:s,h=o-(u-1)*i+(u-1)*i,c=this.__datas.slice((s-1)*i,s<u?s*i:h);return this.__s({total:o,pageIndex:_,pageSize:i,pageCount:u,list:c},e)}return this.__f(1,r)},r.prototype.asyncPageList=function(t,e,r,n){var i=this;return this.__async((function(n){return n.concat(i.pageList(t,e,r))}),n)},r}();function n(t){var e=Array.isArray(t)?[]:{};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];e[r]="object"==typeof i?n(i):i}return e}return function(){function t(){this.__funcs=[],this.__data=[],this.__propKey="setting",this.__access=new r,this.use=this.use.bind(this),this.gen=this.gen.bind(this)}return t.prototype.setv=function(t,e){var r=t.length-1;t.reduce((function(t,n,i){return i===r&&(t[n]=e),t[n]}),this.__data)},t.prototype.addChild=function(t,r,i,s){var a=s.at||0;i--;for(var o=function(o,_){var h=t[o];s.renew&&a===i&&(h=Object.assign?Object.assign(h,s.renew):e(h,s.renew)),s.remove&&a===i&&s.remove.forEach((function(t){h.hasOwnProperty(t)&&delete h[t]})),i>0&&!h.hasOwnProperty(r)&&(h[r]=n(t),u.addChild(h[r],r,i,s))},u=this,_=0,h=t.length;_<h;_++)o(_);return t},t.prototype.transform=function(t,e){if(e){var r=function(t){var e=1;return"number"==typeof t?e=t:Array.isArray(t)&&"number"==typeof t[0]&&"number"==typeof t[1]&&(e=~~(Math.random()*(t[1]-t[0])+t[0])),e},i="number"==typeof e||Array.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]?r(e):"object"==typeof e&&e.length?r(e.length):1,s=new Array(i);delete t[this.__propKey];for(var a=0;a<i;a++)s[a]=n(t);if("object"!=typeof e||"number"==typeof e||Array.isArray(e))t=s;else{var o="number"==typeof e.level?e.level:1,u=e.key||"children";if(e.at&&e.at>=o)throw new Error('setting "at" out of range!');u&&(t[u]=this.addChild(s,u,o,e))}}return t},t.prototype.parseBlock=function(){var t=this,e=function(r,n){var i,s;!Array.isArray(r)&&r.hasOwnProperty(t.__propKey)&&(s=(i=r)[t.__propKey],r=i=t.transform(i,s),n?t.setv(n,r):t.setv([],t.__data=r));var a=function(t){if(r.hasOwnProperty(t)){var i=r[t];Array.isArray(i)&&"▒"!==i[0]?i.forEach((function(r,i){return e(r,n?n.concat([t,i]):[t,i])})):Array.isArray(i)||"object"!=typeof i||e(i,n?n.concat([t]):[t])}};for(var o in r)a(o)};e(this.__data)},t.prototype.setValues=function(t,e){var r=this;if(Array.isArray(t))if("▒"===t[0]){var n=e||[],i=this.__funcs[t[1]].concat();try{this.setv(n,i.length>0?i[0].apply(i,i[1]):t)}catch(e){throw new Error((n.length>0?n.join("."):t)+": error, "+e)}}else t.forEach((function(t,n){return r.setValues(t,e?e.concat([n]):[n])}));else"object"==typeof t&&Object.keys(t).forEach((function(n){return r.setValues(t[n],e?e.concat([n]):[n])}))},t.prototype.use=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return["▒",this.__funcs.push([t,e])-1]},t.prototype.gen=function(t,e){if("object"==typeof t)return e&&(this.__propKey=e),this.__data=t,this.parseBlock(),this.setValues(this.__data),this.__access.data=this.__data,this.__data},Object.defineProperty(t.prototype,"access",{get:function(){return this.__access},enumerable:!0,configurable:!0}),t}()}));
//# sourceMappingURL=shai.js.map
